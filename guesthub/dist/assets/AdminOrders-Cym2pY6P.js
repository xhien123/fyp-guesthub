import{w as te,R as m,E as se,B as ne,j as e,G as ae}from"./index-DGXRDi1R.js";const H=["Received","Preparing","Ready","Delivered","Completed","Cancelled"],re=a=>{switch(a){case"Cancelled":return"bg-stone-200 text-stone-500 border-stone-300";case"Preparing":return"bg-amber-100 text-amber-800 border-amber-200 ring-1 ring-amber-200";case"Ready":return"bg-yellow-100 text-yellow-800 border-yellow-200 ring-1 ring-yellow-300";case"Delivered":return"bg-teal-50 text-teal-700 border-teal-200 ring-1 ring-teal-200";case"Completed":return"bg-emerald-50 text-emerald-700 border-emerald-200 ring-1 ring-emerald-200";case"Received":return"bg-stone-100 text-stone-600 border-stone-200";default:return"bg-gray-50 text-gray-600 border-gray-200"}},T=a=>["Delivered","Completed"].includes(a),ie=a=>a==="Cancelled"?"inline-flex items-center px-2.5 py-0.5 text-[10px] uppercase tracking-widest font-bold border rounded-full bg-stone-100 text-stone-400 border-stone-200":`inline-flex items-center px-2.5 py-0.5 text-[10px] uppercase tracking-widest font-bold border rounded-full ${T(a)?"bg-emerald-50 text-emerald-700 border-emerald-200":"bg-stone-100 text-stone-500 border-stone-200"}`;function oe(a){const o=a.service;return o==="room_delivery"?"room":o==="dine_in"?"pickup":a.method??"room"}const le=a=>{if(!a)return"Just now";const o=new Date(a),g=new Date().getTime()-o.getTime(),c=Math.floor(g/6e4);if(c<1)return"Just now";if(c<60)return`${c}m ago`;const x=Math.floor(c/60);return x<24?`${x}h ago`:`${Math.floor(x/24)}d ago`},ce=a=>a?new Date(a).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}):"--:--",_=a=>{let o="—",l="—",g=!1;const c=a.note||"No detailed note was saved.",x=a.note||"";c!=="No detailed note was saved."&&(c.split(`
`).forEach(u=>{u.includes("Guest Name:")&&(o=u.substring(u.indexOf("Guest Name:")+11).trim()||"Guest (Unknown)"),u.includes("General Note:")&&(l=u.substring(u.indexOf("General Note:")+13).trim()||"—")}),(l.toLowerCase().includes("asap")||l.toLowerCase().includes("sharp"))&&(g=!0));const D=l!=="—"?l.substring(0,40)+(l.length>40?"...":""):"—",O=x.includes("Phone:")&&x.substring(x.indexOf("Phone:")+6).split(`
`)[0].trim()||"N/A";return{guestName:o.split(" ")[0],generalNote:D,isUrgent:g,fullNote:c,items:a.items,phoneExtracted:O}},me=()=>{const{toast:a}=te(),[o,l]=m.useState([]),[g,c]=m.useState(!0),[x,D]=m.useState(null),[O,F]=m.useState(null),[u,K]=m.useState(null),[h,Y]=m.useState(()=>{const t=new URLSearchParams(window.location.search);return t.get("sort")||t.set("sort","created:desc"),t.get("range")||t.set("range","today"),t}),V=t=>{Y(t),window.history.replaceState(null,"",`${window.location.pathname}?${t.toString()}`)},L=h.get("status")||"",M=h.get("range")||"today",z=h.get("date")||"",U=h.get("sort")||"created:desc",v=Number(h.get("page")||"1"),C=Number(h.get("pageSize")||"10"),[f,y]=m.useMemo(()=>{const[t,s]=U.split(":");return[["total","created","room","status","paid","notes"].includes(t)?t:"created",s==="desc"?"desc":"asc"]},[U]),k=(t,s)=>{const n=new URLSearchParams(h);s&&s.length?n.set(t,s):n.delete(t),["status","range"].includes(t)&&n.set("page","1"),t==="range"&&s==="custom"&&!n.get("date")&&n.set("date",new Date().toISOString().split("T")[0]),V(n)},Q=t=>{let s="asc";t==="created"?f===t?s=y==="asc"?"desc":"asc":s="desc":s=f===t&&y==="asc"?"desc":"asc",k("sort",`${t}:${s}`)},I=t=>k("page",String(Math.max(1,t))),q=m.useCallback(async()=>{try{c(!0),D(null);const t=await se();l(Array.isArray(t)?t:[])}catch(t){D(t?.response?.data?.error||"Failed to load orders")}finally{c(!1)}},[]);m.useEffect(()=>{q();const t=ne("http://localhost:4000");return t.on("order:new",s=>{l(n=>[s,...n])}),t.on("order:updated",s=>{l(n=>n.map(r=>r._id===s._id?s:r))}),()=>{t.disconnect()}},[q]);const W=async(t,s)=>{F(t);try{await ae(t,s),a({title:"Order updated",description:`Status → ${s}`,variant:"success"})}catch{a({title:"Failed to update order",variant:"error"})}finally{F(null)}},$=t=>t.total??t.items.reduce((s,n)=>s+n.price*n.quantity,0),X=(t,s,n)=>{if(!t)return!1;const r=new Date(t),N=new Date,p=new Date(N.getFullYear(),N.getMonth(),N.getDate());if(s==="today")return r>=p;if(s==="yesterday"){const d=new Date(p);return d.setDate(p.getDate()-1),r>=d&&r<p}if(s==="week"){const d=new Date(p);return d.setDate(p.getDate()-7),r>=d}if(s==="custom"&&n){const[d,R,P]=n.split("-").map(Number),j=new Date(d,R-1,P),w=new Date(d,R-1,P+1);return r>=j&&r<w}return!0},A=[...o.filter(t=>!(L&&t.status!==L||!X(t.createdAt,M,z)))].sort((t,s)=>{let n=0;switch(f){case"total":n=$(t)-$(s);break;case"created":n=new Date(t.createdAt||0).getTime()-new Date(s.createdAt||0).getTime();break;case"room":n=(t.roomNumber??"").localeCompare(s.roomNumber??"");break;case"status":n=t.status.localeCompare(s.status);break;case"paid":n=Number(T(t.status))-Number(T(s.status));break;case"notes":n=_(t).generalNote.localeCompare(_(s).generalNote);break}return y==="asc"?n:-n}),S=(v-1)*C,B=A.slice(S,S+C),b=({k:t,children:s})=>e.jsxs("button",{onClick:()=>Q(t),className:"inline-flex items-center gap-1 hover:text-zinc-900 text-[10px] font-bold uppercase tracking-widest text-zinc-500 transition-colors",children:[s,e.jsx("span",{className:"text-[10px] text-zinc-400",children:f===t?y==="asc"?"▲":"▼":"▵▿"})]}),Z=t=>{K(t===u?null:t)};return g&&o.length===0?e.jsx("div",{className:"p-10 text-center text-stone-500 font-serif animate-pulse",children:"Synchronizing with Concierge Desk..."}):x?e.jsx("p",{className:"text-red-600 p-10",children:x}):e.jsxs("div",{className:"max-w-[1400px] mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-end mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-serif text-stone-800 mb-2",children:"Concierge Dashboard"}),e.jsx("p",{className:"text-stone-500 font-light",children:"Real-time overview of In-Residence & Dining requests."})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-[10px] uppercase tracking-widest text-stone-400",children:"Sorting By"}),e.jsxs("div",{className:"text-sm font-bold text-stone-800",children:[f==="created"?"Time Placed":f.toUpperCase()," (",y==="asc"?"Oldest First":"Newest First",")"]})]})]}),e.jsxs("div",{className:"mb-8 p-5 border border-stone-200 bg-white shadow-sm rounded-lg flex flex-wrap items-end gap-6",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-widest text-stone-400 mb-2",children:"Status"}),e.jsxs("select",{className:"w-40 bg-stone-50 border border-stone-200 rounded px-3 py-2 text-sm focus:ring-1 focus:ring-stone-400 outline-none",value:L,onChange:t=>k("status",t.target.value),children:[e.jsx("option",{value:"",children:"All Active"}),H.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] font-bold uppercase tracking-widest text-stone-400 mb-2",children:"Time Period"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("select",{className:"w-40 bg-stone-50 border border-stone-200 rounded px-3 py-2 text-sm focus:ring-1 focus:ring-stone-400 outline-none",value:M,onChange:t=>k("range",t.target.value),children:[e.jsx("option",{value:"today",children:"Today (Live)"}),e.jsx("option",{value:"yesterday",children:"Yesterday"}),e.jsx("option",{value:"week",children:"Last 7 Days"}),e.jsx("option",{value:"all",children:"All History"}),e.jsx("option",{value:"custom",children:"Specific Date..."})]}),M==="custom"&&e.jsx("input",{type:"date",className:"bg-stone-50 border border-stone-200 rounded px-3 py-2 text-sm focus:ring-1 focus:ring-stone-400 outline-none",value:z,onChange:t=>k("date",t.target.value)})]})]})]}),e.jsx("div",{className:"bg-white border border-stone-200 rounded-lg shadow-lg overflow-hidden",children:e.jsxs("table",{className:"min-w-full text-sm text-left",children:[e.jsx("thead",{className:"bg-stone-50 border-b border-stone-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-4 font-medium text-stone-500",children:e.jsx(b,{k:"room",children:"Guest / Location"})}),e.jsx("th",{className:"p-4 font-medium text-stone-500 w-[30%]",children:e.jsx(b,{k:"notes",children:"Concierge Alert"})}),e.jsx("th",{className:"p-4 font-medium text-stone-500",children:e.jsx(b,{k:"total",children:"Value"})}),e.jsx("th",{className:"p-4 font-medium text-stone-500",children:e.jsx(b,{k:"created",children:"Time Placed"})}),e.jsx("th",{className:"p-4 font-medium text-stone-500",children:e.jsx(b,{k:"paid",children:"Folio Status"})}),e.jsx("th",{className:"p-4 font-medium text-stone-500",children:e.jsx(b,{k:"status",children:"Fulfillment"})}),e.jsx("th",{className:"p-4 font-medium text-stone-500",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-stone-100",children:[B.map(t=>{const s=$(t),n=oe(t),{guestName:r,generalNote:N,isUrgent:p,fullNote:d,items:R,phoneExtracted:P}=_(t),j=u===t._id,w=le(t.createdAt),E=(w==="Just now"||w.includes("m ago")&&parseInt(w)<15)&&!["Completed","Delivered","Cancelled"].includes(t.status),J=T(t.status),G=t.status==="Cancelled";return e.jsxs(m.Fragment,{children:[e.jsxs("tr",{className:`transition-all duration-200 ${j?"bg-stone-50/80":"hover:bg-stone-50"} ${E?"bg-amber-50/40":""} ${G?"opacity-60":""}`,children:[e.jsx("td",{className:"p-4 align-top",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center text-lg font-serif ${n==="room"?"bg-stone-800 text-white":"bg-white border border-stone-300 text-stone-600"}`,children:n==="room"?e.jsx("i",{className:"fas fa-bed"}):e.jsx("i",{className:"fas fa-utensils"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-serif font-medium text-lg text-stone-900 flex items-center gap-2",children:[n==="room"?`Room ${t.roomNumber}`:"Dine-in",E&&e.jsx("span",{className:"bg-red-600 text-white text-[9px] px-1.5 py-0.5 rounded font-bold tracking-widest uppercase animate-pulse",children:"New"})]}),e.jsx("div",{className:"text-xs text-stone-500 tracking-wide uppercase",children:r})]})]})}),e.jsx("td",{className:"p-4 align-top",children:N!=="—"?e.jsxs("div",{className:`text-xs leading-relaxed p-2 rounded ${p?"bg-red-50 text-red-800 border border-red-100":"text-stone-600"}`,children:[p&&e.jsx("i",{className:"fas fa-bell mr-1 text-red-600 animate-pulse"}),e.jsxs("span",{className:`italic ${G?"line-through":""}`,children:['"',N,'"']})]}):e.jsx("span",{className:"text-stone-300 text-xs italic",children:"No special requests"})}),e.jsxs("td",{className:"p-4 align-top font-serif text-base text-stone-800",children:["$",Number(s).toLocaleString("en-US")]}),e.jsxs("td",{className:"p-4 align-top",children:[e.jsx("div",{className:`text-xs font-medium uppercase tracking-wider ${E?"text-emerald-600 font-bold":"text-stone-600"}`,children:w}),e.jsx("div",{className:"text-[10px] text-stone-400 mt-0.5",children:ce(t.createdAt)})]}),e.jsx("td",{className:"p-4 align-top",children:e.jsxs("div",{className:"flex flex-col items-start gap-1",children:[e.jsx("span",{className:ie(t.status),children:t.status==="Cancelled"?"Voided":J?"Settled":"Pending"}),J&&!G&&e.jsx("span",{className:"text-[9px] text-stone-400",children:"Auto-charged to room"})]})}),e.jsx("td",{className:"p-4 align-top",children:e.jsx("select",{className:`w-full px-3 py-1.5 text-xs font-semibold rounded-md border shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-1 ${re(t.status)}`,value:t.status,onChange:i=>W(t._id,i.target.value),disabled:O===t._id,children:H.map(i=>e.jsx("option",{value:i,children:i},i))})}),e.jsx("td",{className:"p-4 align-top text-right",children:e.jsx("button",{onClick:()=>Z(t._id),className:`w-8 h-8 rounded-full flex items-center justify-center transition-colors ${j?"bg-stone-200 text-stone-800":"text-stone-400 hover:bg-stone-100 hover:text-stone-600"}`,children:e.jsx("i",{className:`fas fa-chevron-${j?"up":"down"}`})})})]}),j&&e.jsx("tr",{className:"bg-stone-50/50 border-b border-stone-200 shadow-inner",children:e.jsx("td",{colSpan:7,className:"p-6",children:e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6 max-w-6xl mx-auto",children:[e.jsxs("div",{className:"bg-white border border-stone-200 rounded-lg shadow-sm p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 border-b border-stone-100 pb-2",children:[e.jsx("h4",{className:"font-serif text-stone-800 text-lg",children:"Order Manifest"}),e.jsx("span",{className:"text-[10px] uppercase tracking-widest text-stone-400",children:"Kitchen Ticket"})]}),e.jsx("ul",{className:"space-y-4",children:R.map((i,ee)=>e.jsxs("li",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-baseline",children:[e.jsxs("span",{className:"font-medium text-stone-700 text-sm",children:[e.jsxs("span",{className:"text-stone-400 mr-2",children:[i.quantity,"x"]}),i.name]}),e.jsxs("span",{className:"font-serif text-stone-800 text-sm",children:["$",(i.price*i.quantity).toFixed(2)]})]}),i.notes&&i.notes.trim()!==""&&e.jsxs("div",{className:"mt-1.5 self-start bg-amber-50 text-amber-800 text-xs px-2 py-1 rounded border border-amber-100 flex items-center gap-1.5",children:[e.jsx("i",{className:"fas fa-pen text-[10px] opacity-50"}),e.jsx("span",{className:"font-medium italic",children:i.notes})]})]},ee))}),e.jsxs("div",{className:"mt-6 pt-4 border-t border-stone-100 flex justify-between items-center",children:[e.jsx("span",{className:"text-xs text-stone-400 uppercase tracking-widest",children:"Total Amount"}),e.jsxs("span",{className:"font-serif text-xl text-stone-900",children:["$",$(t).toFixed(2)]})]})]}),e.jsxs("div",{className:"bg-white border border-stone-200 rounded-lg shadow-sm p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 border-b border-stone-100 pb-2",children:[e.jsx("h4",{className:"font-serif text-stone-800 text-lg",children:"Guest Profile"}),e.jsx("span",{className:"text-[10px] uppercase tracking-widest text-stone-400",children:"Registration"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] uppercase text-stone-400 tracking-widest mb-1",children:"Name"}),e.jsx("div",{className:"text-stone-800 font-medium",children:r})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] uppercase text-stone-400 tracking-widest mb-1",children:"Residence"}),e.jsx("div",{className:"text-stone-800 font-medium text-lg font-serif",children:t.roomNumber||"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] uppercase text-stone-400 tracking-widest mb-1",children:"Contact"}),e.jsx("div",{className:"text-stone-600 text-sm",children:P})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] uppercase text-stone-400 tracking-widest mb-1",children:"Service"}),e.jsx("div",{className:"text-stone-600 text-sm capitalize",children:n==="room"?"In-Room Delivery":"Restaurant Pickup"})]})]}),e.jsxs("div",{className:"pt-4",children:[e.jsx("div",{className:"text-[10px] uppercase text-stone-400 tracking-widest mb-1",children:"Order ID"}),e.jsx("div",{className:"text-xs font-mono text-stone-400 bg-stone-50 p-1 rounded border border-stone-100 truncate",children:t._id})]})]})]}),e.jsxs("div",{className:"bg-[#fffdf5] border border-stone-200 rounded-lg shadow-sm p-5 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-16 h-16 bg-gradient-to-bl from-yellow-500/10 to-transparent rounded-bl-full -mr-8 -mt-8"}),e.jsxs("div",{className:"flex items-center justify-between mb-4 border-b border-stone-200/50 pb-2 relative z-10",children:[e.jsx("h4",{className:"font-serif text-stone-800 text-lg",children:"Butler Instructions"}),e.jsx("span",{className:"text-[10px] uppercase tracking-widest text-stone-400",children:"Requests"})]}),e.jsx("div",{className:"relative z-10 min-h-[140px]",children:d!=="No detailed note was saved."?e.jsx("div",{className:"whitespace-pre-wrap text-sm text-stone-700 leading-relaxed font-serif",children:d}):e.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-stone-400 opacity-60 mt-8",children:[e.jsx("i",{className:"fas fa-feather-alt text-2xl mb-2"}),e.jsx("span",{className:"text-xs italic",children:"No special instructions logged."})]})})]})]})})})]},t._id)}),B.length===0&&e.jsx("tr",{children:e.jsx("td",{className:"p-12 text-center text-stone-400 italic font-serif",colSpan:7,children:"No active orders found in the queue."})})]})]})}),e.jsxs("div",{className:"mt-6 flex items-center justify-between",children:[e.jsxs("div",{className:"text-xs text-stone-400 uppercase tracking-widest",children:["Showing ",S+1,"-",Math.min(S+C,A.length)," of ",A.length," records"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"w-8 h-8 flex items-center justify-center rounded border border-stone-200 bg-white text-stone-500 hover:border-stone-400 disabled:opacity-30 transition",onClick:()=>I(v-1),disabled:v<=1,children:e.jsx("i",{className:"fas fa-chevron-left text-xs"})}),e.jsxs("div",{className:"px-4 text-sm font-serif text-stone-600",children:["Page ",v]}),e.jsx("button",{className:"w-8 h-8 flex items-center justify-center rounded border border-stone-200 bg-white text-stone-500 hover:border-stone-400 disabled:opacity-30 transition",onClick:()=>I(v+1),disabled:S+C>=A.length,children:e.jsx("i",{className:"fas fa-chevron-right text-xs"})})]})]})]})};export{me as default};
