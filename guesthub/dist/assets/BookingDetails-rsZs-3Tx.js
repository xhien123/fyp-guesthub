import{b as I,u as O,R as d,j as e,L as m,n as U,o as $}from"./index-CtBX9Jbf.js";const C="amber-700",L={"DELUXE OCEAN VIEW":120,"FAMILY SUITE":200,"STANDARD TWIN":95,"GARDEN BUNGALOW":150,"PLUNGE POOL VILLA":260,"ROYAL SUITE":320,"PRESIDENTIAL ROOM":420,"JUNIOR SUITE":160,SUPERIOR:140},T=({isOpen:n,onClose:l,onConfirm:t,isProcessing:a})=>n?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm",onClick:l,children:e.jsxs("div",{className:"bg-white shadow-2xl w-full max-w-lg",onClick:i=>i.stopPropagation(),children:[e.jsx("div",{className:"p-6 bg-stone-800 text-white",children:e.jsx("h2",{className:"text-xl font-serif font-bold",children:"Confirm Cancellation"})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsx("p",{className:"text-sm text-stone-700",children:"Are you sure you wish to request cancellation?"}),e.jsxs("div",{className:"border border-red-200 bg-red-50 p-4",children:[e.jsx("p",{className:"text-sm font-semibold text-red-800",children:"Please Note: This action is irreversible."}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:"Per our resort policy, cancellations may be subject to a fee. Furthermore, frequent cancellations (more than 2) may result in your account being restricted from future bookings to ensure availability for all guests."})]}),e.jsx("p",{className:"text-sm text-stone-700",children:"Do you wish to proceed?"})]}),e.jsxs("div",{className:"flex justify-end gap-4 p-4 bg-stone-50 border-t border-stone-200",children:[e.jsx("button",{type:"button",onClick:l,disabled:a,className:"px-6 py-2 font-semibold text-stone-700 border border-stone-300 bg-white hover:bg-stone-100 transition disabled:opacity-50",children:"Keep My Reservation"}),e.jsx("button",{type:"button",onClick:t,disabled:a,className:`px-6 py-2 font-semibold text-white transition ${a?"bg-stone-400":"bg-red-700 hover:bg-red-600"}`,children:a?"Processing...":"Yes, Cancel This Stay"})]})]})}):null,A=()=>{const{id:n}=I(),l=O(),[t,a]=d.useState(null),[i,f]=d.useState(!0),[g,N]=d.useState(null),[D,b]=d.useState(!1),[x,j]=d.useState(!1),y=r=>r==null?"—":`${Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(Number(r))}`;d.useEffect(()=>{n&&(async()=>{try{f(!0),N(null);const p=await U.get(`/api/bookings/${n}`);a(p.data)}catch(p){N(p?.response?.data?.error||"Failed to load booking")}finally{f(!1)}})()},[n]);const c=t?.room&&typeof t.room!="string"?t.room:null,v=c?.title??(typeof t?.room=="string"?t?.room:"Residence");if(i)return e.jsx("p",{className:"text-center py-12 text-lg text-stone-700",children:"Retrieving detailed reservation information..."});if(g)return e.jsxs("p",{className:"text-center py-12 text-xl text-red-600",children:["Error: ",g]});if(!t)return e.jsx("p",{className:"text-center py-12 text-xl text-red-600",children:"Reservation not found."});const w=new Date(t.checkIn),k=new Date(t.checkOut);let s={},u,h;try{if(t.notes&&(s=JSON.parse(t.notes),u=s.uiEstimateUSD,c?.title)){const r=c.title.toUpperCase();h=L[r]||void 0}}catch{}const S=Math.max(0,Math.round((k.setHours(0,0,0,0)-w.setHours(0,0,0,0))/(1e3*60*60*24)))||1,R=r=>{switch(r){case"Confirmed":return"bg-green-100 text-green-700 border-green-300";case"Pending":return"bg-yellow-100 text-yellow-700 border-yellow-300";case"Checked-in":return"bg-blue-100 text-blue-700 border-blue-300";case"Checked-out":return"bg-stone-200 text-stone-700 border-stone-300";default:return"bg-red-100 text-red-700 border-red-300"}},E=async()=>{if(t){j(!0);try{await $(t._id),a(r=>r?{...r,status:"Cancelled"}:null),b(!1),l("/profile?sec=past")}catch(r){alert("Cancellation failed: "+(r?.response?.data?.error||"Please contact the concierge."))}finally{j(!1)}}},P=t.status==="Pending";return e.jsxs(e.Fragment,{children:[e.jsx(T,{isOpen:D,isProcessing:x,onClose:()=>b(!1),onConfirm:E}),e.jsxs("div",{className:"max-w-4xl mx-auto py-12 px-4 sm:px-6 lg:px-8 space-y-8",children:[e.jsxs("header",{className:"flex items-center justify-between border-b border-stone-200 pb-4",children:[e.jsx("h1",{className:"font-serif text-4xl font-thin italic text-stone-900 tracking-tight",children:"Reservation File"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{disabled:!0,className:"bg-amber-700 text-white px-5 py-2 text-sm font-semibold transition opacity-50 cursor-default",children:"View Full Details"}),e.jsx(m,{to:`/bookings/${t._id}/status`,className:"border border-stone-300 text-stone-700 px-5 py-2 text-sm font-semibold hover:bg-stone-50 transition",children:"Track Live Status"}),e.jsx(m,{to:"/profile",className:"border border-stone-300 text-stone-700 px-5 py-2 text-sm font-semibold hover:bg-stone-50 transition",children:"My Profile"})]})]}),e.jsx("div",{className:"border border-stone-200 bg-white shadow-2xl overflow-hidden",children:e.jsxs("div",{className:"p-8 space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-stone-100 pb-4",children:[e.jsx("h2",{className:"font-serif text-3xl font-bold text-stone-900",children:v}),e.jsx("span",{className:`px-4 py-1.5 rounded-full text-sm font-bold uppercase border ${R(t.status)}`,children:t.status})]}),e.jsxs("div",{className:"grid sm:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"border border-stone-200 p-4 bg-stone-50",children:[e.jsx("div",{className:"text-xs uppercase tracking-wider text-stone-500",children:"Check-in"}),e.jsx("div",{className:"font-medium text-stone-800",children:w.toDateString()})]}),e.jsxs("div",{className:"border border-stone-200 p-4 bg-stone-50",children:[e.jsx("div",{className:"text-xs uppercase tracking-wider text-stone-500",children:"Check-out"}),e.jsx("div",{className:"font-medium text-stone-800",children:k.toDateString()})]}),e.jsxs("div",{className:"border border-stone-200 p-4 bg-stone-50",children:[e.jsx("div",{className:"text-xs uppercase tracking-wider text-stone-500",children:"Duration"}),e.jsxs("div",{className:"font-medium text-stone-800",children:[S," Nights"]})]}),e.jsxs("div",{className:"border border-stone-200 p-4 bg-stone-50",children:[e.jsx("div",{className:"text-xs uppercase tracking-wider text-stone-500",children:"Guests"}),e.jsxs("div",{className:"font-medium text-stone-800",children:[t.guests," Total"]})]})]}),e.jsxs("div",{className:"grid sm:grid-cols-2 gap-8 pt-4 border-t border-stone-100",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-xl font-semibold text-stone-800",children:"Principal Guest"}),e.jsxs("div",{className:"border border-stone-200 p-4 space-y-3",children:[e.jsx(o,{label:"Name",value:`${s.title||""} ${s.firstName||""} ${s.lastName||""}`.trim()||"—"}),e.jsx(o,{label:"Email",value:s.email||"—"}),e.jsx(o,{label:"Phone",value:s.phone||"—"}),e.jsx(o,{label:"Country",value:s.country||"—"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-xl font-semibold text-stone-800",children:"Financial Summary"}),e.jsxs("div",{className:"border border-amber-300 p-4 bg-amber-50 space-y-3",children:[e.jsx(o,{label:"Rate per Night",value:h?y(h):"—",color:"text-amber-800"}),e.jsx("div",{className:"border-t border-amber-200 pt-3",children:e.jsx(o,{label:"Estimated Total (USD)",value:u?y(u):"—",size:"text-xl font-bold",color:"text-amber-800"})}),e.jsx("div",{className:"text-xs text-amber-700",children:"*Total excludes local taxes and resort fees, subject to final settlement."})]})]})]}),(s.freeNotes||s.promo||s.loyalty||c?.description)&&e.jsxs("div",{className:"pt-4 border-t border-stone-100 space-y-4",children:[e.jsx("h3",{className:"text-xl font-semibold text-stone-800",children:"Requests & Information"}),c?.description&&e.jsx(o,{label:`${v} Description`,value:c.description,fullWidth:!0}),s.freeNotes&&e.jsx(o,{label:"Concierge Notes",value:s.freeNotes,fullWidth:!0}),(s.promo||s.loyalty)&&e.jsxs("div",{className:"grid sm:grid-cols-2 gap-4",children:[e.jsx(o,{label:"Promo/Voucher Code",value:s.promo||"None Provided"}),e.jsx(o,{label:"Loyalty Number",value:s.loyalty||"—"})]})]}),e.jsxs("div",{className:"pt-4 border-t border-stone-100 flex gap-4",children:[P?e.jsx("button",{disabled:x,onClick:()=>b(!0),className:`border px-6 py-3 font-semibold transition ${x?"border-stone-300 text-stone-500 cursor-not-allowed":"border-red-500 text-red-700 hover:bg-red-50"}`,children:x?"Processing...":"Request Cancellation"}):e.jsx(m,{to:"/events/promotion-packages",className:"border border-amber-700 text-white bg-amber-700 px-6 py-3 font-semibold hover:bg-amber-600 transition",children:"View Our Promotions"}),e.jsx(m,{to:"/rooms",className:`border border-${C} text-${C} px-6 py-3 font-semibold hover:bg-amber-50 transition`,children:"Explore More Residences"})]})]})})]})]})},o=({label:n,value:l,size:t="text-base",color:a="text-stone-800",fullWidth:i=!1})=>e.jsxs("div",{className:`${i?"":"flex justify-between items-start"}`,children:[e.jsx("div",{className:"text-xs uppercase tracking-wider text-stone-500",children:n}),e.jsx("div",{className:`${t} font-medium ${a} ${i?"mt-1":""}`,children:l})]});export{A as default};
