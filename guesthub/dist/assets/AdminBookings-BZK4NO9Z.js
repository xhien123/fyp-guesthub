import{w as q,d as H,R as x,D as J,B as K,j as e,F as V}from"./index-DGXRDi1R.js";const L=["Pending","Confirmed","Checked-in","Checked-out","Declined","Cancelled"],A=n=>(typeof n=="string"?n:n?.title)||"",Z=n=>{switch(n){case"Checked-in":return"bg-teal-100 text-teal-700 border-teal-300";case"Confirmed":return"bg-green-100 text-green-700 border-green-300";case"Pending":return"bg-amber-100 text-amber-700 border-amber-300";case"Checked-out":return"bg-blue-100 text-blue-700 border-blue-300";case"Declined":case"Cancelled":return"bg-red-100 text-red-700 border-red-300";default:return"bg-stone-100 text-stone-700 border-stone-300"}},P=n=>{let r="N/A",h="N/A",j="—",u="—",N={};try{const o=n.notes?JSON.parse(n.notes):{};r=`${o.firstName||""} ${o.lastName||""}`.trim()||"Guest (ID needed)",h=o.email||"N/A",j=o.phone||"—",u=o.freeNotes||"—",N=o}catch{}return{name:r,email:h,phone:j,notes:u,details:N}},X=()=>{const{toast:n}=q(),[r,h]=H(),[j,u]=x.useState([]),[N,o]=x.useState(!0),[I,O]=x.useState(null),[T,B]=x.useState(null),w=r.get("status")||"",y=r.get("from")||"",S=r.get("to")||"",$=r.get("sort")||"checkIn:desc",m=Number(r.get("page")||"1"),p=Number(r.get("pageSize")||"10"),[C,D]=x.useMemo(()=>{const[t,s]=$.split(":");return[["room","guests","checkIn","checkOut","status","notes"].includes(t)?t:"checkIn",s==="asc"?"asc":"desc"]},[$]),g=(t,s)=>{const a=new URLSearchParams(r);s&&s.length?a.set(t,s):a.delete(t),["status","from","to"].includes(t)&&a.set("page","1"),h(a,{replace:!0})},z=t=>g("sort",`${t}:${C===t&&D==="asc"?"desc":"asc"}`),G=t=>g("page",String(Math.max(1,t))),F=t=>{const s=new URLSearchParams(r);s.set("pageSize",String(t)),s.set("page","1"),h(s,{replace:!0})},R=x.useCallback(async()=>{try{o(!0),O(null);const t=await J();u(Array.isArray(t)?t:[])}catch(t){O(t?.response?.data?.error||"Failed to load bookings")}finally{o(!1)}},[]);x.useEffect(()=>{R();const t=K("http://localhost:4000");return t.on("booking:updated",s=>{u(a=>a.find(c=>c._id===s._id)?a.map(c=>c._id===s._id?s:c):[s,...a])}),()=>{t.disconnect()}},[R]);const E=async(t,s)=>{try{await V(t,s),n({title:"Booking updated",description:`Status → ${s}`,variant:"success"})}catch(a){const i=a?.response?.data?.error||"Failed to update booking";n({title:i,variant:"error"})}},f=[...j.filter(t=>!(w&&t.status!==w||y&&new Date(t.checkIn)<new Date(y)||S&&new Date(t.checkOut)>new Date(S)))].sort((t,s)=>{let a=0;switch(C){case"room":a=A(t.room).localeCompare(A(s.room));break;case"guests":a=t.guests-s.guests;break;case"checkIn":a=new Date(t.checkIn).getTime()-new Date(s.checkIn).getTime();break;case"checkOut":a=new Date(t.checkOut).getTime()-new Date(s.checkOut).getTime();break;case"status":a=t.status.localeCompare(s.status);break;case"notes":a=P(t).notes.localeCompare(P(s).notes);break}return D==="asc"?a:-a}),k=(m-1)*p,_=f.slice(k,k+p),b=({k:t,children:s})=>e.jsxs("button",{onClick:()=>z(t),className:"inline-flex items-center gap-1 hover:underline text-xs font-bold uppercase tracking-wider text-stone-600",children:[s,e.jsx("span",{className:"text-xs text-slate-500",children:C===t?D==="asc"?"▲":"▼":"▵▿"})]}),U=t=>{B(t===T?null:t)};return N?e.jsx("p",{children:"Loading…"}):I?e.jsx("p",{className:"text-red-600",children:I}):e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-serif font-bold text-zinc-800 mb-6",children:"Guest Reservations"}),e.jsxs("div",{className:"mb-6 p-4 border border-stone-300 bg-white shadow-md flex flex-wrap items-end gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-600 mb-1",children:"Status"}),e.jsxs("select",{className:"border border-stone-300 px-3 py-2 text-sm",value:w,onChange:t=>g("status",t.target.value),children:[e.jsx("option",{value:"",children:"All"}),L.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-600 mb-1",children:"From (check-in)"}),e.jsx("input",{type:"date",className:"border border-stone-300 px-3 py-2 text-sm",value:y,onChange:t=>g("from",t.target.value)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-slate-600 mb-1",children:"To (check-out)"}),e.jsx("input",{type:"date",className:"border border-stone-300 px-3 py-2 text-sm",value:S,onChange:t=>g("to",t.target.value)})]})]}),e.jsx("div",{className:"rounded-xl border border-stone-200 overflow-x-auto p-0 shadow-lg",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-stone-50 text-stone-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-3",children:e.jsx(b,{k:"room",children:"Residence / Guest"})}),e.jsx("th",{className:"text-left p-3 text-xs font-bold uppercase tracking-wider text-stone-600",children:"Contact Phone"}),e.jsx("th",{className:"text-left p-3 w-[20%]",children:e.jsx(b,{k:"notes",children:"Guest Note"})}),e.jsx("th",{className:"text-left p-3",children:e.jsx(b,{k:"checkIn",children:"Check-in"})}),e.jsx("th",{className:"text-left p-3",children:e.jsx(b,{k:"checkOut",children:"Check-out"})}),e.jsx("th",{className:"text-left p-3",children:e.jsx(b,{k:"status",children:"Status"})}),e.jsx("th",{className:"text-left p-3",children:"Actions"})]})}),e.jsxs("tbody",{className:"bg-white divide-y divide-stone-100",children:[_.map(t=>{const{name:s,email:a,phone:i,notes:c,details:l}=P(t),M=Z(t.status),v=T===t._id;return e.jsxs(x.Fragment,{children:[e.jsxs("tr",{className:`hover:bg-stone-50 transition-colors ${v?"bg-stone-100":""}`,children:[e.jsxs("td",{className:"p-3 pr-6",children:[e.jsx("div",{className:"font-semibold text-base text-stone-900",children:A(t.room)}),e.jsxs("div",{className:"text-xs text-stone-600 pt-1",children:["Guest: ",e.jsx("span",{className:"font-medium text-stone-700",children:s})]}),e.jsx("div",{className:"text-xs text-stone-500",children:a})]}),e.jsx("td",{className:"p-3 text-stone-700 font-semibold whitespace-nowrap",children:i!=="—"?e.jsx("a",{href:`tel:${i}`,className:"text-blue-700 hover:text-blue-500 underline",children:i}):"—"}),e.jsx("td",{className:"p-3 text-xs text-amber-700 italic border-l-2 border-amber-500/50",children:c!=="—"?c.substring(0,50)+(c.length>50?"...":""):"No special requests."}),e.jsxs("td",{className:"p-3 whitespace-nowrap text-stone-700",children:[new Date(t.checkIn).toLocaleDateString(),e.jsxs("div",{className:"text-xs text-stone-500",children:["(",t.guests," Guests)"]})]}),e.jsx("td",{className:"p-3 whitespace-nowrap text-stone-700",children:new Date(t.checkOut).toLocaleDateString()}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:`px-3 py-1 text-xs font-semibold tracking-wider border ${M}`,children:t.status})}),e.jsxs("td",{className:"p-3 space-y-2",children:[e.jsxs("button",{onClick:()=>U(t._id),className:"text-xs font-semibold text-blue-700 hover:text-blue-900 transition flex items-center gap-1",children:[v?"Hide Details":"View Details",e.jsx("i",{className:`fas fa-chevron-${v?"up":"down"} text-[10px]`})]}),e.jsx("select",{className:"border border-stone-300 px-3 py-1.5 text-xs font-medium bg-white hover:border-amber-600 transition",value:t.status,onChange:d=>E(t._id,d.target.value),children:L.map(d=>e.jsx("option",{value:d,children:d},d))})]})]}),v&&e.jsx("tr",{className:"bg-stone-50 border-t border-b border-stone-300",children:e.jsxs("td",{colSpan:7,className:"p-6",children:[e.jsxs("h3",{className:"text-base font-bold text-stone-800 mb-3",children:["Complete Guest Details & Preferences (Booking ID: ",t._id.slice(-6),")"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 md:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"border-r border-stone-200 pr-4",children:[e.jsx("div",{className:"text-xs text-stone-500 uppercase tracking-wider mb-1",children:"Identity"}),e.jsx("p",{className:"font-medium",children:s}),e.jsx("p",{className:"text-sm text-stone-600",children:a}),e.jsxs("p",{className:"text-sm text-stone-600 mt-1",children:["Phone: ",i||"—"]}),e.jsxs("p",{className:"text-xs text-stone-500 mt-1",children:["Nationality: ",l.country||"—"]})]}),e.jsxs("div",{className:"border-r border-stone-200 pr-4",children:[e.jsx("div",{className:"text-xs text-stone-500 uppercase tracking-wider mb-1",children:"Party Size"}),e.jsxs("p",{className:"font-medium",children:["Adults: ",l.adults||"—"]}),e.jsxs("p",{className:"font-medium",children:["Children: ",l.children||"—"," (",l.childrenAges?.join(", ")||"N/A",")"]}),e.jsxs("p",{className:"text-xs text-stone-500 mt-1",children:["Total Guests: ",t.guests]})]}),e.jsxs("div",{className:"border-r border-stone-200 pr-4 sm:col-span-1 md:col-span-1",children:[e.jsx("div",{className:"text-xs text-stone-500 uppercase tracking-wider mb-1",children:"Purchased Add-ons"}),l.selectedAddOns&&Array.isArray(l.selectedAddOns)&&l.selectedAddOns.length>0?e.jsx("ul",{className:"text-sm space-y-1",children:l.selectedAddOns.map(d=>e.jsxs("li",{className:"text-teal-700 font-medium",children:["✓ ",d.replace(/([A-Z])/g," $1").trim()]},d))}):e.jsx("p",{className:"text-sm text-stone-500",children:"None selected."})]}),e.jsxs("div",{className:"sm:col-span-3 md:col-span-2",children:[e.jsx("div",{className:"text-xs text-stone-500 uppercase tracking-wider mb-1",children:"Concierge Notes (Priority)"}),e.jsx("div",{className:"bg-white border border-amber-300 p-3 text-sm text-stone-800 italic",children:c!=="—"?c:"No specific service notes provided."}),e.jsxs("p",{className:"text-xs text-stone-500 mt-2",children:["Loyalty Code: ",l.loyalty||"—"]})]})]})]})})]},t._id)}),_.length===0&&e.jsx("tr",{children:e.jsx("td",{className:"p-4 text-stone-600",colSpan:7,children:"No bookings match the current filter criteria."})})]})]})}),e.jsxs("div",{className:"mt-6 flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"text-sm text-stone-600",children:["Showing ",k+1," - ",Math.min(k+p,f.length)," of ",f.length," entries."]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"rounded border border-stone-300 px-3 py-1 text-sm disabled:opacity-50 hover:bg-stone-100 transition",onClick:()=>G(m-1),disabled:m<=1,children:"Prev"}),e.jsxs("div",{className:"text-sm font-semibold text-stone-700",children:["Page ",m]}),e.jsx("button",{className:"rounded border border-stone-300 px-3 py-1 text-sm disabled:opacity-50 hover:bg-stone-100 transition",onClick:()=>G(m+1),disabled:m*p>=f.length,children:"Next"}),e.jsxs("div",{className:"ml-4 text-sm",children:["Per page:"," ",e.jsx("select",{className:"border border-stone-300 rounded px-2 py-1 text-sm",value:p,onChange:t=>F(Number(t.target.value)),children:[10,20,50].map(t=>e.jsx("option",{value:t,children:t},t))})]})]})]})]})};export{X as default};
