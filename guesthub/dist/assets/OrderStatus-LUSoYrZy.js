import{b as R,u as S,t as O,R as n,w as D,j as e,L as v,x as P}from"./index-CtBX9Jbf.js";const h=["Received","Preparing","Ready","Delivered"],$=5e3,I=({current:r})=>{if(r==="Cancelled")return e.jsx("div",{className:"w-full bg-red-50 border border-red-200 p-4 text-center rounded",children:e.jsx("span",{className:"text-red-800 font-bold uppercase tracking-widest",children:"Order Cancelled"})});const l=Math.max(0,h.findIndex(t=>t===r));return e.jsx("div",{className:"w-full",children:e.jsx("ol",{className:"grid grid-cols-4 gap-4",children:h.map((t,i)=>{const a=i<=l,o=i===l;return e.jsxs("li",{className:"flex flex-col items-center justify-start relative pt-6 pb-2",children:[e.jsx("div",{className:"absolute top-2 h-[3px]",style:{width:`${a?100:0}%`,left:i===0?"50%":"0%",right:i===h.length-1?"50%":"0%",backgroundColor:a?"#b45309":"#d6d3d1",transition:"width 0.5s ease-in-out"}}),e.jsx("div",{className:`absolute top-0 flex h-8 w-8 items-center justify-center border-2 transition-all ${o?"bg-white border-amber-700 shadow-md":a?"bg-amber-700 border-amber-700":"bg-stone-100 border-stone-300"}`,children:e.jsx("span",{className:`text-base font-bold ${a?o?"text-amber-700":"text-white":"text-stone-500"}`,children:a?o?"•":"✓":i+1})}),e.jsx("div",{className:`mt-6 text-center text-xs font-bold uppercase tracking-wider ${a?"text-amber-700":"text-stone-600"}`,children:t})]},t)})})})},L=(r,c)=>c==="Cancelled"?"inline-flex items-center px-4 py-2 text-xs font-semibold border bg-stone-200 text-stone-600 border-stone-300":`inline-flex items-center px-4 py-2 text-xs font-semibold border ${r?"bg-green-100 text-green-800 border-green-300":"bg-stone-100 text-stone-700 border-stone-300"}`;function M(r){return r.service==="room_delivery"?"Residence Delivery":r.service==="dine_in"?"Reserve a table":r.method==="room"?"Residence Delivery":"Reserve a table"}const V=()=>{const{id:r}=R(),c=S(),{toast:l}=O(),[t,i]=n.useState(null),[a,o]=n.useState(!0),[b,f]=n.useState(null),[N,x]=n.useState(!1),[w,u]=n.useState(!1),[p,g]=n.useState(!1),j=s=>`${Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND",minimumFractionDigits:0}).format(s)}`,d=n.useCallback(async()=>{try{f(null);const s=await D(r);i(s)}catch(s){f(s?.response?.data?.error||"Failed to load order status")}finally{o(!1)}},[r]);n.useEffect(()=>{d()},[d]),n.useEffect(()=>{if(t&&t.status!=="Delivered"&&t.status!=="Cancelled"){const s=window.setInterval(d,$);return()=>window.clearInterval(s)}},[d,t]);const y=async()=>{g(!0);try{await P(r),l({title:"Order Cancelled",description:"Your order has been successfully cancelled.",variant:"success"}),u(!1),x(!1),d()}catch(s){l({title:"Cancellation Failed",description:s?.response?.data?.error||"Could not cancel order.",variant:"error"}),g(!1)}};if(a)return e.jsx("div",{className:"container max-w-4xl py-20 text-center mx-auto",children:e.jsx("h1",{className:"text-xl font-light tracking-tight text-neutral-800",children:"Activating Live Tracker..."})});if(b)return e.jsx("div",{className:"container max-w-4xl py-20 text-center mx-auto",children:e.jsx("h1",{className:"text-xl text-red-600",children:b})});if(!t)return e.jsx("div",{className:"container max-w-4xl py-20 text-center mx-auto",children:e.jsx("h1",{className:"text-xl text-red-600",children:"Order not found."})});const C=t.total??t.items.reduce((s,m)=>s+m.price*m.quantity,0),k=()=>{switch(t.status){case"Cancelled":return"This order has been Cancelled. No charges will be applied.";case"Delivered":return`Your order has been Delivered to Residence ${t.roomNumber||"your requested location"}. Thank you for dining with us!`;case"Ready":return"Your order is Ready for Dispatch. Our butler service is preparing the final delivery now.";case"Preparing":return"The culinary team is currently Preparing your exquisite meal. Estimated time remaining: 15-20 minutes.";case"Received":return"Your order has been Received and is being routed to the kitchen for preparation.";default:return"We are processing your order. Please wait for an update."}};return e.jsxs("div",{className:"bg-neutral-50/50 min-h-screen",children:[e.jsxs("div",{className:"container max-w-4xl py-16 space-y-10 mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-stone-300 pb-4",children:[e.jsx("h1",{className:"font-serif text-5xl font-extralight italic text-stone-900",children:"Live Order Status"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(v,{to:`/orders/${t._id}`,className:"border border-stone-300 text-stone-700 px-6 py-3 text-sm font-semibold hover:bg-stone-100 transition tracking-wider",children:"View Details"}),e.jsx(v,{to:"/profile",className:"border border-stone-300 text-stone-700 px-6 py-3 text-sm font-semibold hover:bg-stone-100 transition tracking-wider",children:"My Profile"})]})]}),e.jsxs("div",{className:"border border-stone-200 bg-white p-8 shadow-xl space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between pb-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-stone-500 uppercase tracking-wider",children:"Order ID"}),e.jsx("div",{className:"font-medium text-stone-800 text-lg",children:t._id})]}),e.jsxs("div",{className:"text-sm text-stone-700",children:["Method:"," ",e.jsx("span",{className:"font-semibold text-lg text-stone-800",children:M(t)})]})]}),e.jsx(I,{current:t.status}),e.jsx("div",{className:`flex justify-between items-center p-4 font-semibold text-sm border ${t.status==="Cancelled"?"bg-red-50 border-red-200 text-red-700":"bg-amber-50 border-amber-300 text-amber-900"}`,children:e.jsx("span",{children:k()})}),e.jsxs("div",{className:"flex items-center gap-4 pt-4",children:[e.jsx("span",{className:"text-sm text-stone-700 font-semibold",children:"Payment Status:"}),e.jsx("span",{className:L(!!t.paid,t.status),title:t.paidAt?`Settled at ${new Date(t.paidAt).toLocaleString()}`:"",children:t.status==="Cancelled"?"Voided":t.paid?"Billed to Room / Settled":"Unpaid (Charge to Room)"})]}),e.jsxs("div",{className:"border border-stone-200 bg-stone-50 p-6 space-y-4",children:[e.jsxs("div",{className:"text-xs text-stone-500 uppercase tracking-wider mb-3",children:["Items in Order (",t.items.length,")"]}),e.jsx("ul",{className:"space-y-3 text-sm",children:t.items.map((s,m)=>e.jsxs("li",{className:"flex flex-col gap-1 border-b border-stone-200 pb-2 last:border-none",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"font-medium text-stone-800",children:[s.name," × ",s.quantity]}),e.jsx("span",{className:"font-medium text-stone-800",children:j(s.price*s.quantity)})]}),s.notes&&s.notes.trim()!==""&&e.jsxs("div",{className:"text-xs text-amber-800 italic",children:["Note: ",s.notes]})]},s._id??`${s.name}-${m}`))}),e.jsxs("div",{className:"mt-4 border-t border-stone-300 pt-3 flex justify-between font-semibold text-lg",children:[e.jsx("span",{children:"Order Subtotal"}),e.jsx("span",{children:j(C)})]})]}),e.jsx("div",{className:"pt-6 border-t border-stone-100 flex justify-end",children:t.status==="Received"?e.jsx("button",{onClick:()=>x(!0),className:"text-red-600 hover:text-red-800 hover:bg-red-50 px-4 py-2 rounded text-sm font-semibold transition-colors",children:"Cancel Order"}):e.jsx("button",{onClick:()=>c("/events/promotion-packages"),className:"bg-[#112f4c] text-white px-6 py-3 text-sm font-semibold hover:bg-stone-800 transition tracking-wider shadow-md",children:"View Our Promotions"})})]})]}),N&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white w-full max-w-md shadow-2xl",children:[e.jsx("div",{className:"p-5 bg-stone-800 text-white",children:e.jsx("h3",{className:"font-serif text-xl font-bold",children:"Cancel Request"})}),e.jsx("div",{className:"p-6 space-y-4",children:e.jsx("p",{className:"text-stone-700",children:"Are you sure you want to cancel this order?"})}),e.jsxs("div",{className:"p-4 bg-stone-50 border-t border-stone-200 flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>x(!1),className:"px-4 py-2 text-stone-600 hover:bg-stone-200 rounded transition",children:"Keep Order"}),e.jsx("button",{onClick:()=>{x(!1),u(!0)},className:"px-4 py-2 bg-red-600 text-white hover:bg-red-700 font-semibold transition",children:"Yes, Cancel"})]})]})}),w&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white w-full max-w-lg shadow-2xl border-t-4 border-red-600",children:[e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4 text-red-700",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),e.jsx("h3",{className:"font-serif text-xl font-bold",children:"Please Reconsider"})]}),e.jsxs("div",{className:"space-y-4 text-stone-700 text-sm leading-relaxed",children:[e.jsx("p",{children:"Cancelling an order that has already been processed disrupts our kitchen workflow and may disturb the staff dedicated to your service."}),e.jsx("p",{className:"font-semibold",children:"Frequent cancellations may negatively affect your guest credit rating and future reservation privileges."}),e.jsx("p",{children:"Are you absolutely certain you wish to proceed?"})]})]}),e.jsxs("div",{className:"p-5 bg-stone-50 border-t border-stone-200 flex justify-between items-center",children:[e.jsx("button",{onClick:()=>u(!1),className:"text-stone-500 hover:text-stone-800 text-sm underline",children:"No, I will keep it"}),e.jsx("button",{onClick:y,disabled:p,className:"px-6 py-2.5 bg-stone-800 text-white hover:bg-stone-900 font-bold tracking-wide transition shadow-md",children:p?"Processing...":"I Understand, Cancel Order"})]})]})})]})};export{V as default};
