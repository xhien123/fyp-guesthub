import{b as j,R as n,B as y,j as t}from"./index-DGXRDi1R.js";const v="http://localhost:4000",w=()=>t.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})}),k=()=>{const{id:s}=j(),[i,l]=n.useState([]),[r,c]=n.useState(""),[o,d]=n.useState(!1),x=n.useRef(null),[,b]=n.useState(null),[u,g]=n.useState(null),h=()=>{x.current?.scrollIntoView({behavior:"auto",block:"nearest"})};n.useEffect(()=>{if(!s)return;const e=y(v,{transports:["websocket"],withCredentials:!0});return b(e),e.emit("admin:join",{conversationId:s}),e.on("message:new",a=>{a.conversationId===s&&l(p=>[...p,a])}),()=>{e.disconnect()}},[s]),n.useEffect(()=>{s&&(fetch(`/api/admin/chat/conversations/${s}`,{credentials:"include"}).then(e=>e.json()).then(g).catch(()=>{}),fetch(`/api/admin/chat/conversations/${s}/messages`,{credentials:"include"}).then(e=>e.json()).then(e=>{l(Array.isArray(e)?e:[]),setTimeout(h,50)}).catch(()=>{}))},[s]),n.useEffect(()=>{h()},[i]);const m=async()=>{if(!(!r.trim()||o||!s)){d(!0);try{(await fetch(`/api/admin/chat/conversations/${s}/reply`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({text:r})})).ok&&c("")}catch(e){console.error(e)}finally{d(!1)}}},f=u?.displayName||u?.meta?.guestName||"Guest";return t.jsxs("div",{className:"flex flex-col h-full bg-[#f8f8f6]",children:[t.jsx("div",{className:"flex-shrink-0 h-20 bg-white border-b border-stone-200 px-6 flex items-center justify-between shadow-sm z-10",children:t.jsxs("div",{children:[t.jsx("h2",{className:"font-serif text-xl text-stone-900 truncate max-w-md",children:f}),t.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[t.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500 animate-pulse"}),t.jsx("p",{className:"text-xs text-stone-500 font-medium uppercase tracking-wider",children:"Active Session"})]})]})}),t.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[i.map(e=>{const a=e.senderType==="admin";return e.senderType==="bot"||e.senderType==="system"?t.jsx("div",{className:"flex justify-center my-4",children:t.jsx("span",{className:"px-3 py-1 bg-stone-200/50 rounded-full text-[10px] font-bold uppercase tracking-widest text-stone-500",children:e.text})},e._id):t.jsx("div",{className:`flex ${a?"justify-end":"justify-start"}`,children:t.jsxs("div",{className:"max-w-[70%] group relative",children:[!a&&t.jsx("span",{className:"block ml-1 mb-1 text-[10px] font-bold uppercase tracking-widest text-stone-400",children:f}),t.jsx("div",{className:`px-5 py-3.5 text-sm leading-relaxed shadow-sm ${a?"bg-stone-800 text-stone-50 rounded-2xl rounded-tr-sm":"bg-white text-stone-800 border border-stone-200 rounded-2xl rounded-tl-sm"}`,children:e.text}),t.jsx("div",{className:`text-[10px] text-stone-400 mt-1 transition-opacity opacity-0 group-hover:opacity-100 ${a?"text-right mr-1":"ml-1"}`,children:new Date(e.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})},e._id)}),t.jsx("div",{ref:x})]}),t.jsx("div",{className:"flex-shrink-0 bg-white border-t border-stone-200 p-5",children:t.jsxs("div",{className:"flex gap-3 items-end max-w-4xl mx-auto",children:[t.jsx("div",{className:"flex-1 relative",children:t.jsx("textarea",{className:"w-full bg-stone-50 border border-stone-200 rounded-xl px-4 py-3 text-sm text-stone-900 focus:ring-2 focus:ring-stone-900/10 focus:border-stone-400 outline-none transition-all resize-none",rows:1,placeholder:"Type your reply...",value:r,onChange:e=>c(e.target.value),onKeyDown:e=>{e.key==="Enter"&&!e.shiftKey&&(e.preventDefault(),m())}})}),t.jsx("button",{className:"flex-shrink-0 h-11 w-11 bg-stone-900 text-white rounded-xl flex items-center justify-center hover:bg-black active:scale-95 transition-all disabled:opacity-50 disabled:scale-100 shadow-lg shadow-stone-900/20",onClick:m,disabled:!r.trim()||o,children:o?t.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}):t.jsx(w,{})})]})})]})};export{k as default};
