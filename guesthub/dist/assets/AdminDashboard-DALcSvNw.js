import{R as c,D as _,E as q,j as t,L as E}from"./index-DGXRDi1R.js";const O=n=>{const o=new Date;return o.setDate(o.getDate()-n),o.toISOString().split("T")[0]},b=(n,o)=>{const i=new Date(n);return i.setDate(i.getDate()+o),i.toISOString().split("T")[0]},L=({label:n,value:o,sub:i,color:g})=>t.jsxs("div",{className:"bg-white p-6 border border-stone-200 shadow-md",children:[t.jsx("div",{className:"text-sm text-stone-600 uppercase tracking-wider",children:n}),t.jsx("div",{className:`text-3xl font-serif font-bold mt-1 ${g||"text-zinc-900"}`,children:o}),i&&t.jsx("div",{className:"text-xs text-stone-500 mt-1",children:i})]}),H=n=>typeof n=="string"?"Room ID: "+n.substring(0,4):n?.title||"Unknown Room",X=()=>{const[n,o]=c.useState([]),[i,g]=c.useState([]),[P,T]=c.useState(!0),[v,j]=c.useState(null),[x,I]=c.useState(O(0)),$=c.useMemo(()=>new Date(x),[x]),a=(e=>{const r=b(e,1),s=b(e,-6),l=s,h=b(e,-13),p=e.toISOString().split("T")[0];return{currentStart:s,currentEnd:r,prevStart:h,prevEnd:l,dailyTarget:p}})($);if(c.useEffect(()=>{(async()=>{try{j(null);const[e,r]=await Promise.all([_(),q()]);o(Array.isArray(e)?e:[]),g(Array.isArray(r)?r:[])}catch(e){j(e?.response?.data?.error||"Failed to load admin dashboard")}finally{T(!1)}})()},[]),P)return t.jsx("p",{children:"Loading…"});if(v)return t.jsx("p",{className:"text-red-600",children:v});const y=e=>e.total??e.items.reduce((r,s)=>r+s.price*s.quantity,0),N=(e,r,s)=>{if(!e)return!1;const l=new Date(e).toISOString().split("T")[0];return l>=r&&l<s},A=i.filter(e=>e.paid).reduce((e,r)=>e+y(r),0),w=(e,r)=>i.filter(s=>s.paid&&s.paidAt&&N(s.paidAt,e,r)).reduce((s,l)=>s+y(l),0),S=(e,r)=>n.filter(s=>s.status!=="Declined"&&s.status!=="Cancelled"&&s.createdAt?.startsWith&&N(s.createdAt,e,r)).length,z=w(a.prevEnd,a.currentEnd),B=w(a.prevStart,a.prevEnd),M=S(a.prevEnd,a.currentEnd),F=S(a.prevStart,a.prevEnd),u=i.filter(e=>["Received","Preparing","Ready"].includes(e.status)),m=u.filter(e=>["Ready","Preparing"].includes(e.status)),D=m.reduce((e,r)=>e+r.items.length,0),G=n.filter(e=>e.status==="Pending").length,V=n.filter(e=>e.status==="Confirmed"&&e.checkIn?.startsWith(a.dailyTarget)).length,W=n.filter(e=>e.status==="Checked-in"&&e.checkOut?.startsWith(a.dailyTarget)).length,k=({label:e,value:r,comparisonValue:s,total:l,currency:h,color:p})=>{const d=r-s,f=h,Q=d===0?"No change from prior 7 days":d>0?`+${f?"$":""}${Math.abs(d).toLocaleString()} vs. prior 7 days`:`-${f?"$":""}${Math.abs(d).toLocaleString()} vs. prior 7 days`,U=d===0?"text-stone-500":d>0?"text-green-600 font-bold":"text-red-600 font-bold",R=C=>f?`$${C.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0})}`:String(C);return t.jsxs("div",{className:"bg-white p-6 border border-stone-200 shadow-md",children:[t.jsx("div",{className:"text-sm text-stone-600 uppercase tracking-wider",children:e}),t.jsx("div",{className:`text-4xl font-serif font-bold mt-1 ${p||"text-zinc-900"}`,children:R(r)}),t.jsx("div",{className:"text-xs text-stone-500 mt-1",children:t.jsx("span",{className:U,children:Q})}),t.jsxs("div",{className:"text-xs text-stone-500 mt-2 pt-2 border-t border-stone-100",children:[t.jsx("span",{className:"font-semibold",children:"Overall Total:"})," ",R(l)]})]})};return t.jsxs("div",{className:"space-y-8",children:[t.jsx("h1",{className:"font-serif text-3xl font-bold text-zinc-800",children:"Operational Command Center"}),t.jsxs("div",{className:"flex items-center gap-4 p-4 border border-stone-300 bg-white shadow-md",children:[t.jsx("label",{className:"text-sm font-semibold text-zinc-800 uppercase tracking-wider",children:"Report End Date:"}),t.jsx("input",{type:"date",value:x,onChange:e=>I(e.target.value),className:"border border-stone-300 px-3 py-2 text-base",max:O(0)}),t.jsxs("span",{className:"text-xs text-stone-600 ml-4",children:["Showing 7-day period ending on ",new Date(x).toLocaleDateString()]})]}),t.jsxs("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-4",children:[t.jsx(k,{label:"Revenue Settled (Last 7 Days)",value:z,comparisonValue:B,total:A,currency:!0,color:"text-yellow-500"}),t.jsx(k,{label:"New Reservations (Last 7 Days)",value:M,comparisonValue:F,total:n.length,currency:!1,color:"text-zinc-900"}),t.jsx(L,{label:`Confirmed Arrivals (${a.dailyTarget})`,value:String(V),sub:"Confirmed guests checking in",color:"text-green-600"}),t.jsx(L,{label:`Guest Departures (${a.dailyTarget})`,value:String(W),sub:"Guests finalizing their stay",color:"text-red-600"})]}),t.jsx("h2",{className:"text-xl font-serif font-bold text-zinc-800 pt-4 border-t border-stone-200",children:"Real-Time Service Queue (LIVE)"}),t.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[t.jsxs("div",{className:"bg-white p-6 border border-stone-200 shadow-xl space-y-4",children:[t.jsxs("h3",{className:"text-lg font-semibold flex justify-between items-center",children:["In-Room Dining (Active Queue)",t.jsxs("span",{className:`px-3 py-1 text-sm font-bold ${D>0?"bg-yellow-500 text-zinc-900":"bg-green-100 text-green-700"}`,children:[m.length," Orders / ",D," Items"]})]}),m.length>0?t.jsxs("ul",{className:"space-y-2",children:[m.slice(0,5).map(e=>t.jsxs("li",{className:"p-3 border border-yellow-300 bg-yellow-50 flex justify-between items-center",children:[t.jsxs("div",{children:[t.jsx("span",{className:"font-semibold",children:e.roomNumber}),t.jsxs("span",{className:"text-sm text-stone-600 ml-2",children:["(",e.items.length," items)"]})]}),t.jsx("span",{className:"text-sm font-bold text-amber-700",children:e.status})]},e._id)),u.length>5&&t.jsxs("li",{className:"text-sm text-stone-500 text-center",children:["... ",u.length-5," more orders"]})]}):t.jsx("p",{className:"text-stone-500 italic",children:"No critical orders currently preparing or ready for dispatch."}),t.jsx(E,{to:"/admin/orders",className:"text-sm font-semibold text-blue-700 hover:underline block pt-2 border-t border-stone-100",children:"Manage All Orders →"})]}),t.jsxs("div",{className:"bg-white p-6 border border-stone-200 shadow-xl space-y-4",children:[t.jsxs("h3",{className:"text-lg font-semibold flex justify-between items-center",children:["Pending Reservations (Manual Review)",t.jsxs("span",{className:"text-sm text-stone-500",children:[G," to Confirm"]})]}),n.filter(e=>e.status==="Pending").slice(0,5).map(e=>t.jsxs("div",{className:"p-3 border border-stone-300 flex justify-between items-center",children:[t.jsx("span",{className:"font-semibold text-sm",children:H(e.room)}),t.jsxs("span",{className:"text-xs text-stone-600 ml-2",children:["Check-in: ",new Date(e.checkIn).toLocaleDateString()]}),t.jsx("span",{className:"text-sm text-amber-700",children:"Pending"})]},e._id)),t.jsx(E,{to:"/admin/bookings",className:"text-sm font-semibold text-blue-700 hover:underline block pt-2 border-t border-stone-100",children:"Review Bookings & Guests →"})]})]})]})};export{X as default};
