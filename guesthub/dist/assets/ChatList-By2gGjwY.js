import{R as a,C as g,B as b,j as s,L as j}from"./index-DGXRDi1R.js";const N="http://localhost:4000",w=()=>s.jsx("svg",{className:"w-4 h-4 text-stone-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),k=()=>{const[l,i]=a.useState([]),[d,x]=a.useState(""),u=g().pathname.split("/").pop(),o=a.useCallback(()=>{fetch("/api/admin/chat/conversations",{credentials:"include"}).then(e=>e.json()).then(e=>i(Array.isArray(e)?e:[])).catch(()=>i([]))},[]);a.useEffect(()=>{o()},[o]),a.useEffect(()=>{const e=b(N,{transports:["websocket"],withCredentials:!0});return e.emit("admin:join:notifications"),e.on("chat:new-message",()=>{o()}),()=>{e.disconnect()}},[o]);const m=l.filter(e=>{const n=e.displayName||e.meta?.guestName||e.user?.name||"Guest",t=e.lastMessage||"",r=d.toLowerCase();return n.toLowerCase().includes(r)||t.toLowerCase().includes(r)}),h=e=>e?new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0}):"";return s.jsxs("div",{className:"flex flex-col h-full bg-white",children:[s.jsxs("div",{className:"px-5 pt-6 pb-2 border-b border-stone-100 z-10 bg-white sticky top-0 shadow-sm",children:[s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsx("h1",{className:"font-serif text-2xl text-stone-900 tracking-tight",children:"Inbox"}),l.some(e=>e.isUnread)&&s.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded bg-rose-100 text-rose-700 text-[10px] font-bold uppercase tracking-widest",children:[l.filter(e=>e.isUnread).length," New"]})]}),s.jsxs("div",{className:"relative mb-2",children:[s.jsx("div",{className:"absolute left-3 top-2.5",children:s.jsx(w,{})}),s.jsx("input",{className:"w-full bg-stone-50 border-none rounded-lg pl-10 pr-4 py-2.5 text-sm text-stone-900 placeholder-stone-400 focus:ring-2 focus:ring-stone-200 transition-all outline-none",placeholder:"Search guest name...",value:d,onChange:e=>x(e.target.value)})]})]}),s.jsx("div",{className:"flex-1 overflow-y-auto",children:m.length===0?s.jsxs("div",{className:"p-10 text-center",children:[s.jsx("div",{className:"w-12 h-12 bg-stone-100 rounded-full flex items-center justify-center mx-auto mb-3 text-xl",children:"ðŸ“­"}),s.jsx("p",{className:"text-stone-400 text-sm font-serif italic",children:"No messages found."})]}):s.jsx("div",{className:"divide-y divide-stone-50",children:m.map(e=>{const n=e._id===u,t=e.isUnread,r=h(e.lastMessageAt||e.updatedAt),p=e.displayName||e.meta?.guestName||"Guest";return s.jsxs(j,{to:`/admin/chat/${e._id}`,onClick:()=>{i(f=>f.map(c=>c._id===e._id?{...c,isUnread:!1,unreadCount:0}:c))},className:`group block px-5 py-4 transition-all duration-200 border-l-4 ${n?"bg-stone-50 border-stone-900":t?"bg-rose-50/30 border-rose-500":"bg-white border-transparent hover:bg-stone-50 hover:border-stone-200"}`,children:[s.jsxs("div",{className:"flex justify-between items-start mb-1.5",children:[s.jsxs("div",{className:"flex items-center gap-2 overflow-hidden max-w-[75%]",children:[t&&s.jsx("span",{className:"w-2.5 h-2.5 rounded-full bg-rose-500 flex-shrink-0 shadow-sm animate-pulse",title:"New Message"}),s.jsx("span",{className:`text-sm truncate ${t?"font-bold text-stone-900":n?"font-semibold text-stone-900":"font-medium text-stone-700"}`,children:p})]}),s.jsx("span",{className:`text-[10px] font-medium whitespace-nowrap ml-2 ${t?"text-rose-600":"text-stone-400"}`,children:r})]}),s.jsxs("div",{className:"flex justify-between items-end",children:[s.jsx("p",{className:`text-xs line-clamp-1 leading-relaxed pr-4 flex-1 ${t?"text-stone-900 font-medium":"text-stone-500"}`,children:e.lastMessage||s.jsx("span",{className:"italic opacity-50",children:"No messages yet"})}),e.unreadCount>0&&s.jsx("span",{className:"flex-shrink-0 h-4 min-w-[16px] px-1 bg-rose-500 text-white text-[9px] font-bold rounded-full flex items-center justify-center ml-2 shadow-sm",children:e.unreadCount})]})]},e._id)})})})]})};export{k as default};
